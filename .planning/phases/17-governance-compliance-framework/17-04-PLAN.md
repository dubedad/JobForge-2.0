---
phase: 17-governance-compliance-framework
plan: 04
type: execute
wave: 2
depends_on: ["17-02"]
files_modified:
  - src/jobforge/governance/reports/__init__.py
  - src/jobforge/governance/reports/radar.py
  - src/jobforge/governance/reports/export.py
  - src/jobforge/governance/reports/templates/audit_detailed.html
  - src/jobforge/governance/reports/templates/audit_summary.html
  - tests/governance/reports/test_radar.py
  - tests/governance/reports/test_export.py
autonomous: true

must_haves:
  truths:
    - "Radar chart shows DAMA 11-dimension compliance profile"
    - "PDF report includes embedded radar chart"
    - "Export supports JSON, Markdown, and PDF formats"
    - "Two audience modes: detailed (technical) and summary (committee)"
  artifacts:
    - path: "src/jobforge/governance/reports/radar.py"
      provides: "DAMA radar chart generation using matplotlib"
      exports: ["generate_dama_radar_chart"]
    - path: "src/jobforge/governance/reports/export.py"
      provides: "Multi-format export (JSON, Markdown, PDF)"
      exports: ["export_audit_json", "export_audit_markdown", "export_audit_pdf"]
    - path: "src/jobforge/governance/reports/templates/audit_detailed.html"
      provides: "Jinja2 template for technical audience PDF"
      contains: "<html"
  key_links:
    - from: "src/jobforge/governance/reports/radar.py"
      to: "matplotlib.pyplot"
      via: "import"
      pattern: "import matplotlib"
    - from: "src/jobforge/governance/reports/export.py"
      to: "weasyprint"
      via: "import"
      pattern: "from weasyprint import"
---

<objective>
Create the governance report generation layer with radar charts and multi-format export.

Purpose: Enables audit-ready compliance reports with visual DAMA dimension profiles. Supports structured tables with toggle for narrative expansion, and two audience modes (technical/summary) per CONTEXT.md decisions.

Output: Radar chart generator, JSON/Markdown/PDF exporters, Jinja2 HTML templates for PDF.
</objective>

<execution_context>
@C:\Users\Administrator\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Administrator\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-governance-compliance-framework/17-CONTEXT.md
@.planning/phases/17-governance-compliance-framework/17-RESEARCH.md
@.planning/phases/17-governance-compliance-framework/17-02-SUMMARY.md
@src/jobforge/governance/compliance/scoring.py
@src/jobforge/governance/compliance/audit.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DAMA radar chart generator</name>
  <files>src/jobforge/governance/reports/__init__.py, src/jobforge/governance/reports/radar.py, tests/governance/reports/test_radar.py</files>
  <action>
Create src/jobforge/governance/reports/ directory with __init__.py.

Implement radar.py with generate_dama_radar_chart():
1. Takes dimension_scores: dict[str, float] (dimension name -> 0-100 score)
2. Takes optional title: str = "DAMA DMBOK Compliance Profile"
3. Returns bytes (PNG image data)

Implementation details (from RESEARCH.md):
- Use matplotlib.pyplot with polar projection
- 11 DAMA dimensions arranged in circle
- Use abbreviated dimension names to prevent overlap:
  "Data Governance", "Data Architecture", "Data Modeling",
  "Storage & Ops", "Data Security", "Integration",
  "Metadata Mgmt", "Data Quality", "Reference Data",
  "DW & BI", "Document Mgmt"
- Green fill color (#2E7D32) with 25% alpha
- Scale 0-100% with gridlines at 20, 40, 60, 80, 100
- Figure size 8x8 inches, 150 DPI
- Save to BytesIO buffer, return bytes

Write tests:
- Chart generates without error
- Returns PNG bytes (check magic bytes: b'\x89PNG')
- Handles missing dimensions (defaults to 0)
- Handles all-zero scores
- Handles all-100 scores
  </action>
  <verify>
pytest tests/governance/reports/test_radar.py -v
python -c "
from jobforge.governance.reports.radar import generate_dama_radar_chart
scores = {'Data Governance': 85, 'Metadata Management': 70, 'Data Quality': 60}
img = generate_dama_radar_chart(scores)
print(f'Generated radar chart: {len(img)} bytes')
assert img[:4] == b'\x89PNG', 'Not PNG format'
print('PNG format verified')
"
  </verify>
  <done>generate_dama_radar_chart produces PNG image of DAMA dimension radar chart</done>
</task>

<task type="auto">
  <name>Task 2: Create Jinja2 HTML templates for PDF reports</name>
  <files>src/jobforge/governance/reports/templates/audit_detailed.html, src/jobforge/governance/reports/templates/audit_summary.html</files>
  <action>
Create src/jobforge/governance/reports/templates/ directory.

Create audit_detailed.html (technical audience):
- Full AuditResult display with all evidence
- Embedded radar chart (via base64 data URI)
- Table of all dimension scores with weights
- Evidence artifacts listed per dimension
- Gap analysis with full details
- Prioritized recommendations with impact/effort
- Generated timestamp
- CSS styling for print (page breaks, headers)

Create audit_summary.html (governance committee):
- Executive summary format
- Embedded radar chart (prominent)
- Overall score and maturity level
- High-level compliance status per dimension
- Top 3-5 gaps only
- Top 3 recommendations
- Minimal technical detail

Both templates use Jinja2 variables:
- {{ audit }} - AuditResult object
- {{ chart_uri }} - base64 data URI for radar chart
- {{ generated_at }} - ISO timestamp

CSS requirements:
- Clean, professional styling
- Printable (avoid colors that don't print well)
- Page break handling for multi-page PDFs
- GC-appropriate formatting (formal, no emojis)
  </action>
  <verify>ls src/jobforge/governance/reports/templates/*.html | wc -l</verify>
  <done>Two Jinja2 templates exist for detailed and summary report modes</done>
</task>

<task type="auto">
  <name>Task 3: Implement multi-format export functions</name>
  <files>src/jobforge/governance/reports/export.py, tests/governance/reports/test_export.py</files>
  <action>
Implement export.py with three export functions:

1. export_audit_json(audit: AuditResult, output_path: Path) -> None
   - Serialize AuditResult to JSON using model_dump_json(indent=2)
   - Include all fields

2. export_audit_markdown(audit: AuditResult, output_path: Path, detailed: bool = True) -> None
   - Generate Markdown report
   - Detailed mode: full evidence and recommendations
   - Summary mode: executive summary format
   - Include ASCII-art representation of scores (bar chart style)
   - Tables for dimension scores

3. export_audit_pdf(
     audit: AuditResult,
     output_path: Path,
     detailed: bool = True,
     chart_bytes: bytes | None = None
   ) -> None
   - If chart_bytes is None, generate radar chart
   - Load appropriate Jinja2 template (detailed or summary)
   - Embed chart as base64 data URI
   - Render HTML with WeasyPrint
   - Write PDF to output_path

Add export_audit(audit, output_path, format: str) dispatcher that routes to correct function based on file extension or format parameter.

Write tests:
- JSON export produces valid JSON
- Markdown export produces valid Markdown
- PDF export produces PDF file (check %PDF magic bytes)
- Both detailed and summary modes work
  </action>
  <verify>
pytest tests/governance/reports/test_export.py -v
python -c "
from jobforge.governance.compliance.audit import DAMAAudit, AuditResult
from jobforge.governance.reports.export import export_audit_json, export_audit_markdown
from jobforge.pipeline.config import PipelineConfig
from pathlib import Path
import tempfile

config = PipelineConfig()
audit = DAMAAudit(config)
result = audit.run_audit('project')

with tempfile.TemporaryDirectory() as tmpdir:
    json_path = Path(tmpdir) / 'audit.json'
    md_path = Path(tmpdir) / 'audit.md'
    export_audit_json(result, json_path)
    export_audit_markdown(result, md_path)
    print(f'JSON: {json_path.stat().st_size} bytes')
    print(f'Markdown: {md_path.stat().st_size} bytes')
"
  </verify>
  <done>export_audit_json, export_audit_markdown, export_audit_pdf all produce valid output files</done>
</task>

</tasks>

<verification>
```bash
# All report tests pass
pytest tests/governance/reports/ -v

# Radar chart generation works
python -c "
from jobforge.governance.reports.radar import generate_dama_radar_chart
from jobforge.governance.compliance.scoring import GC_DAMA_WEIGHTS
scores = {dim: 75 for dim in GC_DAMA_WEIGHTS.keys()}
img = generate_dama_radar_chart(scores)
print(f'Radar chart: {len(img)} bytes, PNG: {img[:4] == bytes([0x89, 0x50, 0x4e, 0x47])}')
"

# PDF generation works (requires WeasyPrint)
python -c "
from jobforge.governance.compliance.audit import DAMAAudit
from jobforge.governance.reports.export import export_audit_pdf
from jobforge.pipeline.config import PipelineConfig
from pathlib import Path
import tempfile

config = PipelineConfig()
audit = DAMAAudit(config)
result = audit.run_audit('project')

with tempfile.TemporaryDirectory() as tmpdir:
    pdf_path = Path(tmpdir) / 'audit.pdf'
    export_audit_pdf(result, pdf_path, detailed=True)
    content = pdf_path.read_bytes()
    print(f'PDF: {len(content)} bytes, valid: {content[:4] == b\"%PDF\"}')
"
```
</verification>

<success_criteria>
- Radar chart generates PNG with 11 DAMA dimensions
- Templates exist for both detailed and summary modes
- JSON export produces valid, complete JSON
- Markdown export is readable and formatted
- PDF export produces valid PDF with embedded chart
- All tests pass (expect 15+ tests)
</success_criteria>

<output>
After completion, create `.planning/phases/17-governance-compliance-framework/17-04-SUMMARY.md`
</output>
