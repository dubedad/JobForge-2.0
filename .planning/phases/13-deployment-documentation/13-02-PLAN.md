---
phase: 13-deployment-documentation
plan: 02
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - docs/architecture.md
  - docs/integration-guide.md
  - docs/extending-intents.md
autonomous: true

must_haves:
  truths:
    - "User understands system architecture from diagram"
    - "User can set up and run JobForge by following step-by-step guide"
    - "User knows how to ask workforce intelligence questions with examples"
    - "User can add new intent patterns following tutorial"
  artifacts:
    - path: "docs/architecture.md"
      provides: "System architecture with Mermaid diagram"
      contains: "```mermaid"
    - path: "docs/integration-guide.md"
      provides: "Step-by-step setup and example queries"
      contains: "## Quick Start"
    - path: "docs/extending-intents.md"
      provides: "Tutorial for adding new query patterns"
      contains: "wiq_intents.yaml"
  key_links:
    - from: "docs/integration-guide.md"
      to: "docker-compose.yml"
      via: "setup instructions reference"
      pattern: "docker compose"
    - from: "docs/extending-intents.md"
      to: "orbit/config/intents/wiq_intents.yaml"
      via: "file reference"
      pattern: "orbit/config/intents"
---

<objective>
Create comprehensive integration documentation for Orbit + JobForge stack.

Purpose: Enable both technical developers and business users to understand, run, and extend the workforce intelligence platform.

Output: docs/architecture.md (system overview + diagram), docs/integration-guide.md (setup + examples), docs/extending-intents.md (tutorial)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-deployment-documentation/13-CONTEXT.md
@.planning/phases/13-deployment-documentation/13-RESEARCH.md

# Reference for documentation content
@orbit/config/adapters/jobforge.yaml
@orbit/config/intents/wiq_intents.yaml
@src/jobforge/api/routes.py

# Reference Docker setup from Plan 01
@docker-compose.yml
@.env.example
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create architecture documentation with Mermaid diagram</name>
  <files>docs/architecture.md</files>
  <action>
Create docs/architecture.md with system architecture overview.

**Sections:**

1. **Overview**
   - What JobForge is (workforce intelligence platform)
   - What Orbit integration provides (natural language queries)
   - Core value: auditable provenance from source to output

2. **Architecture Diagram** (Mermaid)
   Create graph showing:
   - User Browser at top
   - Docker Compose stack containing:
     - Demo UI (port 8080) - deployment wizard
     - API (port 8000) - FastAPI query endpoints
     - Data layer: Gold Tables (24 parquet), Metadata Catalog (JSON)
   - External: Claude API for text-to-SQL
   - Arrows showing data flow:
     - Browser -> Demo UI -> SSE stream
     - Browser -> API -> DuckDB -> Gold Tables
     - API -> Claude API -> SQL generation

3. **Component Descriptions**
   - Query API: FastAPI endpoints for data/metadata/compliance queries
   - Demo UI: SSE-powered deployment narration wizard
   - Gold Layer: 24 star-schema parquet tables
   - Catalog: JSON metadata for lineage and descriptions
   - Intent System: Pattern-based query classification (wiq_intents.yaml)

4. **Data Flow**
   Explain the query path:
   1. User submits natural language question
   2. Intent classification (pattern matching or LLM)
   3. Route to data/metadata/compliance endpoint
   4. For data queries: Claude generates SQL, DuckDB executes
   5. Results returned with provenance

Use Mermaid graph TB syntax (renders in GitHub, VS Code, and most markdown viewers).
  </action>
  <verify>Mermaid diagram renders correctly in VS Code preview or GitHub</verify>
  <done>docs/architecture.md explains system with visual diagram</done>
</task>

<task type="auto">
  <name>Task 2: Create integration guide with setup steps and example queries</name>
  <files>docs/integration-guide.md</files>
  <action>
Create docs/integration-guide.md as the primary user guide.

**Sections:**

1. **Prerequisites**
   - Docker Desktop installed
   - Anthropic API key (for data queries)
   - 2GB disk space for container images

2. **Quick Start** (5 steps)
   ```
   1. Clone repository
   2. Copy .env.example to .env
   3. Add your ANTHROPIC_API_KEY to .env
   4. Run: ./start.sh (or start.bat on Windows)
   5. Browser opens to http://localhost:8080
   ```

3. **Manual Start** (without browser auto-open)
   ```
   docker compose up -d
   docker compose logs -f  # watch startup
   ```

4. **Verifying Installation**
   - Check health: `curl http://localhost:8000/api/health`
   - List tables: `curl http://localhost:8000/api/tables`

5. **Example Queries by Domain**

   **Labour Supply/Demand:**
   - "How many software developers are projected for 2025?"
   - "What is the retirement rate for healthcare occupations?"
   - "Show immigration numbers for TEER 2 occupations"

   **Occupation Lookups:**
   - "What is the class title for NOC 21232?"
   - "List all TEER 1 unit groups"
   - "What skills are needed for data analysts?"

   **Trend Analysis:**
   - "Employment growth forecast for broad category 2"
   - "How many school leavers expected in 2030?"
   - "Compare employment projections 2023 vs 2033"

   **Compliance/Lineage:**
   - "Where does dim_noc data come from?"
   - "Show lineage for cops_employment"
   - "Is WiQ DADM compliant?"

6. **API Reference** (brief)
   - POST /api/query/data - Natural language SQL queries
   - POST /api/query/metadata - Lineage and structure queries
   - GET /api/compliance/{framework} - Compliance reports
   - GET /api/tables - List available tables
   - GET /api/health - Health check

7. **Stopping the Stack**
   ```
   docker compose down        # Stop containers
   docker compose down -v     # Also remove volumes
   ```

8. **Troubleshooting**
   - "Connection refused": API not ready, wait for healthcheck
   - "CORS error": Check CORS_ORIGINS in .env matches frontend port
   - "API key invalid": Verify ANTHROPIC_API_KEY in .env
  </action>
  <verify>All curl commands in guide work against running stack</verify>
  <done>docs/integration-guide.md provides complete setup and usage instructions</done>
</task>

<task type="auto">
  <name>Task 3: Create intent extension tutorial</name>
  <files>docs/extending-intents.md</files>
  <action>
Create docs/extending-intents.md as a step-by-step tutorial for adding new query patterns.

**Tutorial Structure:**

1. **Understanding Intent Classification**
   - How questions are routed (patterns -> LLM fallback)
   - Intent categories: data_query, metadata_query, compliance_query
   - Role of wiq_intents.yaml (domain vocabulary)
   - Role of jobforge.yaml (endpoint routing)

2. **Step-by-Step: Adding a New Query Pattern**

   **Scenario:** Add support for "What certifications are needed for [occupation]?"

   **Step 1: Identify the endpoint**
   - This is attribute data -> route to data_query -> /api/query/data

   **Step 2: Add pattern to jobforge.yaml**
   ```yaml
   # orbit/config/adapters/jobforge.yaml
   intents:
     - name: data_query
       patterns:
         # ... existing patterns ...
         - "certifications"
         - "what certifications"
   ```

   **Step 3: Add domain vocabulary to wiq_intents.yaml**
   ```yaml
   # orbit/config/intents/wiq_intents.yaml
   intent_categories:
     attribute_queries:
       keywords:
         # ... existing keywords ...
         - certification
         - credential
         - license
       sample_questions:
         # ... existing questions ...
         - "What certifications are needed for nurses?"
   ```

   **Step 4: Test the new pattern**
   ```bash
   curl -X POST http://localhost:8000/api/query/data \
     -H "Content-Type: application/json" \
     -d '{"question": "What certifications are needed for software developers?"}'
   ```

3. **Adding a New Entity Type**
   - When to add entities (new domain concepts)
   - Entity structure: description, patterns (regex), examples
   - Example: Adding "certification_type" entity

4. **Testing Intent Classification**
   - How to verify patterns match correctly
   - Checking LLM fallback behavior
   - Common mistakes (overlapping patterns, too generic)

5. **Configuration File Reference**
   - jobforge.yaml: endpoint routing, HTTP config
   - wiq_intents.yaml: domain vocabulary, fallback behavior
   - File locations: orbit/config/adapters/, orbit/config/intents/
  </action>
  <verify>Tutorial example patterns work when added to config files</verify>
  <done>docs/extending-intents.md enables users to add new query patterns</done>
</task>

</tasks>

<verification>
1. docs/architecture.md:
   - Mermaid diagram renders in VS Code or GitHub preview
   - All components mentioned in diagram are described

2. docs/integration-guide.md:
   - Quick Start steps are accurate
   - Example queries match API capabilities
   - curl commands use correct endpoints

3. docs/extending-intents.md:
   - Tutorial references correct file paths
   - YAML examples are valid syntax
   - Step-by-step instructions are complete
</verification>

<success_criteria>
- Architecture diagram shows complete system topology
- Integration guide covers setup, examples, and troubleshooting
- Intent extension tutorial is step-by-step with working examples
- All documentation uses consistent terminology from PROJECT.md
- Mermaid diagrams render correctly
</success_criteria>

<output>
After completion, create `.planning/phases/13-deployment-documentation/13-02-SUMMARY.md`
</output>
