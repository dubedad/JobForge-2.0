---
phase: 13-deployment-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Dockerfile
  - docker-compose.yml
  - .env.example
  - start.sh
  - start.bat
  - .gitignore
  - .dockerignore
autonomous: true
user_setup:
  - service: docker
    why: "Container runtime for Docker Compose deployment"
    env_vars: []
    dashboard_config:
      - task: "Install Docker Desktop (includes Docker Compose v2)"
        location: "https://www.docker.com/products/docker-desktop/"

must_haves:
  truths:
    - "User can start JobForge stack with single docker-compose up command"
    - "Services wait for API health before starting dependent services"
    - "Environment variables configure ports and API keys without code changes"
    - "Browser opens automatically to demo interface on startup via wrapper script"
  artifacts:
    - path: "Dockerfile"
      provides: "FastAPI container image definition"
      contains: "EXPOSE 8000"
    - path: "docker-compose.yml"
      provides: "Multi-service orchestration"
      contains: "healthcheck"
    - path: ".env.example"
      provides: "Environment variable template"
      contains: "ANTHROPIC_API_KEY"
    - path: "start.sh"
      provides: "Cross-platform startup with browser launch"
      contains: "docker compose up"
  key_links:
    - from: "docker-compose.yml"
      to: "Dockerfile"
      via: "build context"
      pattern: "build:\\s*\\."
    - from: "docker-compose.yml"
      to: ".env"
      via: "env_file directive"
      pattern: "env_file.*\\.env"
---

<objective>
Create Docker Compose infrastructure for one-command deployment of JobForge stack.

Purpose: Enable users to start the entire workforce intelligence platform with a single command, with automatic browser launch and environment-based configuration.

Output: Dockerfile, docker-compose.yml, .env.example, start.sh/start.bat wrapper scripts
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-deployment-documentation/13-CONTEXT.md
@.planning/phases/13-deployment-documentation/13-RESEARCH.md

# Existing code to integrate with
@src/jobforge/api/routes.py
@src/jobforge/cli/commands.py
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Dockerfile for FastAPI application</name>
  <files>Dockerfile, .dockerignore</files>
  <action>
Create Dockerfile following FastAPI official patterns from research:

1. Use python:3.11-slim as base image (supports ARM64 + AMD64)
2. Set WORKDIR /app
3. Copy pyproject.toml first, then pip install -e . (for Docker cache)
4. Copy src/, data/catalog/, orbit/ directories
5. Expose port 8000
6. Use exec form CMD: ["uvicorn", "jobforge.api:app", "--host", "0.0.0.0", "--port", "8000"]

Create .dockerignore to exclude:
- .git/, .planning/, .pytest_cache/, __pycache__/
- *.pyc, .env, .coverage
- tests/ (not needed in production image)
- WIQ.pbix, *.parquet (gold data mounted as volume)

Key points:
- Do NOT copy data/gold/ - mount as volume for easier updates
- Do NOT use shell form CMD (breaks signal handling)
- Include curl for healthcheck (apt-get install curl in build)
  </action>
  <verify>docker build -t jobforge-api . succeeds without errors</verify>
  <done>Dockerfile builds valid container image with FastAPI app</done>
</task>

<task type="auto">
  <name>Task 2: Create docker-compose.yml with healthchecks and services</name>
  <files>docker-compose.yml</files>
  <action>
Create docker-compose.yml with two services (not three - no nginx needed since demo is Python-served):

**Service: api**
- build: . (uses Dockerfile)
- container_name: jobforge-api
- ports: "${API_PORT:-8000}:8000"
- env_file: .env
- environment: CORS_ORIGINS=http://localhost:${DEMO_PORT:-8080}
- volumes: ./data:/app/data (mount gold tables and catalog)
- healthcheck:
  - test: ["CMD", "curl", "-f", "http://localhost:8000/api/health"]
  - interval: 10s, timeout: 5s, retries: 5, start_period: 10s
- networks: jobforge-network

**Service: demo**
- build: .
- container_name: jobforge-demo
- command: ["jobforge", "demo", "--host", "0.0.0.0", "--port", "8080"]
- ports: "${DEMO_PORT:-8080}:8080"
- depends_on:
    api:
      condition: service_healthy
- networks: jobforge-network

**Network:**
- jobforge-network: bridge driver

Do NOT include version field (deprecated in Compose v2).
Do NOT hardcode ports - use ${VAR:-default} substitution.
  </action>
  <verify>docker compose config validates without errors</verify>
  <done>docker-compose.yml defines api and demo services with healthcheck-based startup ordering</done>
</task>

<task type="auto">
  <name>Task 3: Create environment template and startup scripts</name>
  <files>.env.example, start.sh, start.bat, .gitignore</files>
  <action>
**Create .env.example:**
```
# JobForge Docker Compose Configuration
# Copy to .env and fill in your values: cp .env.example .env

# API Configuration
API_PORT=8000
DEMO_PORT=8080

# REQUIRED: Your Anthropic API key for data queries
# Get from: https://console.anthropic.com/settings/keys
ANTHROPIC_API_KEY=sk-ant-api03-...

# CORS origins (comma-separated, no spaces)
CORS_ORIGINS=http://localhost:8080
```

**Create start.sh (Unix/macOS/Git Bash):**
```bash
#!/bin/bash
# JobForge stack launcher with browser auto-open

echo "Starting JobForge stack..."
docker compose up -d

echo "Waiting for API to be healthy..."
until docker compose ps api | grep -q "healthy"; do
    sleep 2
    echo "  Waiting..."
done

echo "Services ready!"

# Open browser based on OS
DEMO_PORT=${DEMO_PORT:-8080}
if [[ "$OSTYPE" == "darwin"* ]]; then
    open http://localhost:$DEMO_PORT
elif [[ "$OSTYPE" == "msys" || "$OSTYPE" == "cygwin" ]]; then
    start http://localhost:$DEMO_PORT
else
    xdg-open http://localhost:$DEMO_PORT 2>/dev/null || echo "Open http://localhost:$DEMO_PORT"
fi

echo ""
echo "JobForge running:"
echo "  Demo:     http://localhost:$DEMO_PORT"
echo "  API:      http://localhost:${API_PORT:-8000}"
echo "  API Docs: http://localhost:${API_PORT:-8000}/docs"
echo ""
echo "To stop: docker compose down"
```

**Create start.bat (Windows CMD):**
```batch
@echo off
echo Starting JobForge stack...
docker compose up -d

echo Waiting for API to be healthy...
:wait
docker compose ps api | findstr "healthy" >nul
if errorlevel 1 (
    timeout /t 2 >nul
    echo   Waiting...
    goto wait
)

echo Services ready!
start http://localhost:8080

echo.
echo JobForge running:
echo   Demo:     http://localhost:8080
echo   API:      http://localhost:8000
echo   API Docs: http://localhost:8000/docs
echo.
echo To stop: docker compose down
```

**Update .gitignore:**
Add .env to gitignore (but NOT .env.example)
  </action>
  <verify>
1. .env.example contains ANTHROPIC_API_KEY placeholder
2. start.sh has execute permission (chmod +x start.sh if needed)
3. .gitignore contains .env entry
  </verify>
  <done>Users can copy .env.example to .env, set API key, run start.sh or start.bat</done>
</task>

</tasks>

<verification>
1. Build container: `docker build -t jobforge-api .` succeeds
2. Validate compose: `docker compose config` shows valid YAML
3. Test stack startup (if Docker available):
   - Copy .env.example to .env
   - Set dummy ANTHROPIC_API_KEY
   - Run `docker compose up -d`
   - Verify: `docker compose ps` shows both services
   - Verify: `curl http://localhost:8000/api/health` returns {"status": "ok"}
   - Run `docker compose down` to clean up
</verification>

<success_criteria>
- Dockerfile builds without errors
- docker-compose.yml validates without errors
- .env.example documents all required environment variables
- start.sh and start.bat provide cross-platform launch with browser auto-open
- Stack can be started with single `docker compose up` command
</success_criteria>

<output>
After completion, create `.planning/phases/13-deployment-documentation/13-01-SUMMARY.md`
</output>
